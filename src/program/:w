#include "comm_head.h"
#include "stdio.h"
#include "process.h"

char *str = "129djwqhdsajd128dw9i39ie93i8494urjoiew98kdkd";
char tmp[10];
int tot = 0;

void to_str(int data, char *tmp);

void main() {
    int pid;
    printf("#### Fork test ####\n");
    printf("Origin string: %s\n", str);

    printf("I'm going to fork now.\n");
    pid = fork();
    if (pid) {
        put_color_str("Fork success!\n", 0xe8);
        put_color_str("I'm the parent process\n", 0xe8);
        put_color_str("The PID of child process is ", 0xe8);
        to_str(pid, tmp);
        put_color_str(tmp, 0xe8); puts("\n");
        put_color_str("Now wait for child process to count the charactors of origin string\n", 0xe8);
        wait();
        put_color_str("Count result: ", 0xe8);
        to_str(tot, tmp);
        put_color_str(tmp, 0xe8); puts("\n");
    } else {
        put_color_str("I'm the child process.\n", 0x8e);
        while (str[tot]) ++tot;
    }
}

void to_str(int data, char *tmp) {
    while (data) {
        *tmp++ = data % 10;
        data /= 10;
    }
    *tmp = 0;
}
